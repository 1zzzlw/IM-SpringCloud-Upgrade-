<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zzzlew.mapper.GroupConversationMapper">

    <insert id="insertGroupConversation"
            parameterType="com.zzzlew.pojo.dto.conversation.GroupConversationDTO">
        insert into group_conversation (id, group_name, group_avatar, owner_id)
        values (#{id}, #{groupName}, #{groupAvatar}, #{ownerId})
    </insert>

    <insert id="insertGroupMember"
            parameterType="com.zzzlew.pojo.dto.user.GroupMemberDTO">
        insert into group_member (group_id, user_id, role)
        values (#{groupId}, #{userId}, #{role})
    </insert>

    <update id="updateGroupConversation">
        update group_conversation
        set member_count = member_count + 1,
            group_avatar = #{groupAvatar}
        where id = #{conversationId}
    </update>

    <select id="selectGroupConversation"
            resultType="com.zzzlew.pojo.vo.conversation.ConversationVO">
        select group_name as name, group_avatar as avatar
        from group_conversation
        where id = #{conversationId}
    </select>

    <select id="selectGroupConversationListByConversationIdList"
            resultType="com.zzzlew.pojo.entity.GroupConversation">
        select id, group_name, group_avatar, member_count
        from group_conversation
        where id in
        <foreach collection="groupIdList" item="groupId" open="(" close=")" separator=",">
            #{groupId}
        </foreach>
    </select>

    <select id="selectGroupNumber" resultType="java.lang.String"
            parameterType="java.lang.String">
        select user_id
        from group_member
        where group_id = #{conversationId}
    </select>

</mapper>